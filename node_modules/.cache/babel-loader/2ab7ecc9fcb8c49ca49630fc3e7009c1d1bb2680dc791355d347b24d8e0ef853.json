{"ast":null,"code":"var _jsxFileName = \"/home/giicoo/projects/3DOM FRONT/3dom-Front/src/App.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport './ChatApp.css';\nimport { useChats } from './hooks/useChats';\nimport { useMessages, useStreamMessage } from './hooks/useMessages';\nimport { MessageThread } from './components/message';\nimport { v4 as uuidv4 } from 'uuid';\nimport { useUploadFile } from './hooks/useFile';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatApp = () => {\n  _s();\n  var _window$Telegram, _window$Telegram$WebA, _window$Telegram$WebA2, _chats$find;\n  const [settings, setSettings] = useState({\n    isOpen: false,\n    theme: 'light'\n  });\n\n  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp\n  const user = ((_window$Telegram = window.Telegram) === null || _window$Telegram === void 0 ? void 0 : (_window$Telegram$WebA = _window$Telegram.WebApp) === null || _window$Telegram$WebA === void 0 ? void 0 : (_window$Telegram$WebA2 = _window$Telegram$WebA.initDataUnsafe) === null || _window$Telegram$WebA2 === void 0 ? void 0 : _window$Telegram$WebA2.user) || {\n    id: 11,\n    first_name: '–ì–æ—Å—Ç—å',\n    photo_url: 'https://via.placeholder.com/100'\n  };\n  const [inputText, setInputText] = useState('');\n  const [replyContext, setReplyContext] = useState(null);\n  const [attachment, setAttachment] = useState(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [chatMenu, setChatMenu] = useState({\n    chatId: null,\n    isOpen: false,\n    position: null\n  });\n\n  //____________MODELS_____________________________________________________________\n  // –≠—Ç–æ —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ backend\n  const [models, setModel] = useState([{\n    id: 'llama2',\n    name: 'Llama 2'\n  }, {\n    id: 'deepseek-r1:8b',\n    name: 'DeepSeek'\n  }, {\n    id: 'mistral',\n    name: 'Mistral'\n  }]);\n  const [activeModel, setActiveModel] = useState('llama2');\n  //_____________________________________________________________________________________________\n\n  //_____________CHATS__________________________________________________________________________\n  // const [chats, setChats] = useState<Chat[]>([\n  //   { id: '1', title: '–ß–∞—Ç 1', lastMessage: '–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫', model: 'llama2' },\n  //   { id: '2', title: '–ß–∞—Ç 2', lastMessage: '–ß–µ–º –º–æ–∂–µ–º –ø–æ–º–æ—á—å?', model: 'deepseek-r1' },\n  //   { id: '3', title: '–ß–∞—Ç 3', lastMessage: '–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã', model: 'mistral' },\n  // ]);\n  const {\n    chats,\n    setChats,\n    activeChat,\n    setActiveChat,\n    createAuto,\n    delChat\n  } = useChats(user.id);\n  const [isCreatingChat, setIsCreatingChat] = useState(false);\n  const [newChatTitle, setNewChatTitle] = useState('');\n\n  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–∞\n  const handleChatChange = async chatId => {\n    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —á–∞—Ç, –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π\n    setChats(prev => {\n      const prevChat = prev.find(c => c.id === activeChat);\n      if (prevChat !== null && prevChat !== void 0 && prevChat.isEmpty) {\n        return prev.filter(c => c.id !== activeChat);\n      }\n      return prev;\n    });\n    setActiveChat(chatId);\n    setIsMenuOpen(false);\n\n    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ\n    setChats(prev => prev.map(chat => chat.id === chatId ? {\n      ...chat,\n      unreadCount: 0\n    } : chat));\n  };\n\n  // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–∞—Ç–∞\n  useEffect(() => {\n    if (isCreatingChat && newChatInputRef.current) {\n      newChatInputRef.current.focus();\n    }\n  }, [isCreatingChat]);\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞\n  const handleCreateChat = async modelId => {\n    const newChat = {\n      id: \"0\",\n      title: `–ß–∞—Ç ${chats.filter(c => c.model === modelId).length + 1}`,\n      lastMessage: '–ù–æ–≤—ã–π —á–∞—Ç —Å–æ–∑–¥–∞–Ω',\n      model: modelId,\n      isEmpty: true // –¢–µ–ø–µ—Ä—å —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ\n    };\n    setChats(prev => [...prev, newChat]);\n    setParent(null);\n    await handleChatChange(newChat.id);\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –ø–æ –º–æ–¥–µ–ª—è–º\n  const getChatsByModel = modelId => {\n    return chats.filter(chat => chat.model === modelId);\n  };\n\n  // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–∞—Ç–∞, –±—ç–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç((\n  const handleRenameChat = newName => {\n    setChats(prev => prev.map(chat => chat.id === chatMenu.chatId ? {\n      ...chat,\n      title: newName\n    } : chat));\n    setChatMenu({\n      chatId: null,\n      isOpen: false,\n      position: null\n    });\n  };\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞\n  const handleDeleteChat = () => {\n    if (!chatMenu.chatId) return;\n    setChats(prev => prev.filter(chat => chat.id !== chatMenu.chatId));\n    if (activeChat === chatMenu.chatId) {\n      var _remainingChats$;\n      const remainingChats = chats.filter(chat => chat.id !== chatMenu.chatId);\n      setActiveChat(((_remainingChats$ = remainingChats[0]) === null || _remainingChats$ === void 0 ? void 0 : _remainingChats$.id) || '');\n    }\n    delChat(chatMenu.chatId);\n    setChatMenu({\n      chatId: null,\n      isOpen: false,\n      position: null\n    });\n  };\n  //_____________________________________________________________________________\n\n  //__________________MESSAGES_________________________\n  const {\n    messages,\n    setMessages,\n    send\n  } = useMessages(activeChat);\n  const [parentId, setParent] = useState(null);\n  const {\n    chunks,\n    error,\n    start\n  } = useStreamMessage(activeChat);\n  const [rootID, setRootID] = useState(null);\n  const {\n    upload\n  } = useUploadFile();\n  useEffect(() => {\n    if (chunks.length > 0) {\n      setMessages(prevMessages => {\n        if (prevMessages.length === 0) return prevMessages;\n        const updatedMessages = [...prevMessages];\n        const lastIndex = updatedMessages.length - 1;\n        updatedMessages[lastIndex] = {\n          ...updatedMessages[lastIndex],\n          content: chunks.join(\"\")\n        };\n        return updatedMessages;\n      });\n    }\n  }, [chunks, parentId]);\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\n  useEffect(() => {\n    // TODO: –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∞ –∫–∞–∫-–Ω–∏–±—É–¥—å –ø–æ-–¥—Ä—É–≥–æ–º—É\n    // const welcomeMessage: Message = {\n    //   id: ,\n    //   parent_id: parent_id,\n    //   content: `–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —á–∞—Ç \"${chats.find(c => c.id === activeChat)?.title}\". –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`,\n    //   role: 'assistant',\n    //   created_at: String(new Date()),\n    // };\n    // setMessages([welcomeMessage]);\n  }, [activeChat]);\n\n  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    console.log(messages);\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages]);\n  const handleSendMessage = async () => {\n    if (!inputText.trim() && !attachment) return;\n    const currentChat = chats.find(chat => chat.id === activeChat);\n    let requestMessage;\n    let newMsg;\n    if (!currentChat || currentChat.isEmpty) {\n      // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ —Å –∞–≤—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –¥–µ–ª–∞–Ω–∏–µ –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º\n      const newChatId = await createAuto(inputText, {\n        telegram_id: user.id,\n        model: activeModel,\n        title: '–ß–ë–î'\n      });\n      requestMessage = {\n        chat_id: newChatId,\n        parent_id: null,\n        res_ids: [],\n        role: 'user',\n        content: inputText\n      };\n      newMsg = await send(requestMessage);\n      setParent(newMsg.id);\n\n      // Reset input and attachment\n      setInputText('');\n      setAttachment(null);\n      setReplyContext(null);\n\n      // Start streaming the assistant response\n      const tempId = uuidv4();\n      const newResponse = {\n        id: tempId,\n        parent_id: newMsg.id,\n        res_ids: newMsg.res_ids,\n        role: \"assistant\",\n        content: \"\"\n      };\n      setMessages(prev => [...prev, newResponse]);\n      const fullResponse = await start(newMsg.id);\n      const requestMessageAs = {\n        chat_id: requestMessage.chat_id,\n        parent_id: newMsg.id,\n        res_ids: newMsg.res_ids,\n        role: \"assistant\",\n        content: fullResponse\n      };\n      const responseAs = await send(requestMessageAs);\n      setRootID(responseAs.id);\n      // –ó–∞–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (id === \"0\") –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ\n      setMessages(prev => prev.map(msg => msg.id === tempId ? responseAs // ‚úÖ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n      : msg));\n      await handleChatChange(newChatId);\n      return;\n    } else {\n      requestMessage = {\n        chat_id: activeChat,\n        parent_id: replyContext ? replyContext.messageId : rootID,\n        res_ids: [],\n        role: 'user',\n        content: inputText\n      };\n      newMsg = await send(requestMessage);\n      setParent(newMsg.id);\n    }\n\n    // Reset input and attachment\n    setInputText('');\n    setAttachment(null);\n    setReplyContext(null);\n\n    // Start streaming the assistant response\n    const tempId = uuidv4();\n    const newResponse = {\n      id: tempId,\n      parent_id: newMsg.id,\n      res_ids: newMsg.res_ids,\n      role: \"assistant\",\n      content: \"\"\n    };\n    setMessages(prev => [...prev, newResponse]);\n    const fullResponse = await start(newMsg.id);\n    const requestMessageAs = {\n      chat_id: requestMessage.chat_id,\n      parent_id: newMsg.id,\n      res_ids: newMsg.res_ids,\n      role: \"assistant\",\n      content: fullResponse\n    };\n    const responseAs = await send(requestMessageAs);\n    setRootID(responseAs.id);\n    // –ó–∞–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (id === \"0\") –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ\n    setMessages(prev => prev.map(msg => msg.id === tempId ? responseAs // ‚úÖ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n    : msg));\n\n    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤\n    setChats(prev => prev.map(chat => chat.id === activeChat ? {\n      ...chat,\n      lastMessage: inputText || '–í–ª–æ–∂–µ–Ω–∏–µ',\n      unreadCount: 0\n    } : chat));\n  };\n  const [lastRenderedMessageId, setLastRenderedMessageId] = useState(null);\n  const [childIndexes, setChildIndexes] = useState({});\n\n  //___________________________________________________________\n\n  const fileInputRef = useRef(null);\n  const messagesEndRef = useRef(null);\n  const newChatInputRef = useRef(null);\n\n  // –¢–µ–º—ã\n  useEffect(() => {\n    var _window$matchMedia, _window;\n    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Telegram API\n    const isDarkMode = (_window$matchMedia = (_window = window).matchMedia) === null || _window$matchMedia === void 0 ? void 0 : _window$matchMedia.call(_window, '(prefers-color-scheme: dark)').matches;\n    const theme = isDarkMode ? 'dark' : 'light';\n\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É\n    document.body.classList.toggle('dark-theme', theme === 'dark');\n  }, []);\n\n  // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Ç–µ–º—ã\n  const toggleTheme = () => {\n    const newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';\n    document.body.classList.toggle('dark-theme', newTheme === 'dark');\n  };\n\n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞\n  const generateBotResponse = (userText, context) => {\n    const responses = [\"–Ø –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.\", \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤–º–µ—Å—Ç–µ.\", \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –Ø —É–∂–µ —Ä–∞–±–æ—Ç–∞—é –Ω–∞–¥ —ç—Ç–∏–º.\", \"–•–æ—Ä–æ—à–æ, —è –∑–∞–ø–∏—Å–∞–ª —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ß—Ç–æ –µ—â–µ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?\", \"–û—Ç–ª–∏—á–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ! –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏–º –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä.\"];\n    if (context) {\n      return `–û—Ç–≤–µ—á–∞—è –Ω–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ \"${context.messageText}\": ${responses[Math.floor(Math.random() * responses.length)]}`;\n    }\n    return responses[Math.floor(Math.random() * responses.length)];\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞\n  const handleAttachment = e => {\n    if (e.target.files && e.target.files[0]) {\n      setAttachment(e.target.files[0]);\n      upload(activeChat, e.target.files[0]);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n  const handleOpenMenu = (chatId, e) => {\n    e.stopPropagation();\n    const rect = e.currentTarget.getBoundingClientRect();\n    setChatMenu({\n      chatId,\n      isOpen: true,\n      position: {\n        top: rect.bottom + 5,\n        left: rect.left - 100\n      }\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-app\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"menu-button\",\n        onClick: () => setIsMenuOpen(!isMenuOpen),\n        children: \"\\u2630\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: ((_chats$find = chats.find(c => c.id === activeChat)) === null || _chats$find === void 0 ? void 0 : _chats$find.title) || '–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 9\n      }, this), activeChat && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"create-chat-button\",\n        onClick: () => {\n          var _chats$find2;\n          const currentModel = ((_chats$find2 = chats.find(c => c.id === activeChat)) === null || _chats$find2 === void 0 ? void 0 : _chats$find2.model) || activeModel;\n          handleCreateChat(currentModel);\n        },\n        children: \"\\uFF0B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `side-menu ${isMenuOpen ? 'open' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"settings-button\",\n        onClick: () => setSettings(prev => ({\n          ...prev,\n          isOpen: true\n        })),\n        children: \"\\u2699\\uFE0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 9\n      }, this), settings.isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"settings-modal\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"settings-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"close-settings\",\n            onClick: () => setSettings(prev => ({\n              ...prev,\n              isOpen: false\n            })),\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"user-profile\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: user.photo_url || 'https://via.placeholder.com/100',\n              alt: \"\\u0410\\u0432\\u0430\\u0442\\u0430\\u0440\",\n              className: \"user-avatar\",\n              onError: e => {\n                e.target.src = 'https://via.placeholder.com/100';\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 438,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: [user.first_name, user.last_name].filter(Boolean).join(' ') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 446,\n              columnNumber: 17\n            }, this), user.username && /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"@\", user.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 35\n            }, this), user.language_code && /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"\\u042F\\u0437\\u044B\\u043A: \", user.language_code.toUpperCase()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 452,\n              columnNumber: 40\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 437,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"theme-switcher\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                const newTheme = settings.theme === 'light' ? 'dark' : 'light';\n                setSettings(prev => ({\n                  ...prev,\n                  theme: newTheme\n                }));\n                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–º–µ–Ω—ã —Ç–µ–º—ã –≤ Telegram WebApp\n              },\n              children: settings.theme === 'light' ? 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 456,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"settings-overlay\",\n          onClick: () => setSettings(prev => ({\n            ...prev,\n            isOpen: false\n          }))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 428,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"menu-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\u041C\\u043E\\u0438 \\u0447\\u0430\\u0442\\u044B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 475,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"close-menu\",\n          onClick: () => setIsMenuOpen(false),\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"categories-tabs\",\n        children: models.map(model => /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `category-tab ${activeModel === model.id ? 'active' : ''}`,\n          onClick: () => setActiveModel(model.id),\n          children: model.name\n        }, model.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-list\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"create-chat-in-category small\",\n          onClick: () => handleCreateChat(activeModel),\n          children: \"\\uFF0B \\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0447\\u0430\\u0442\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 495,\n          columnNumber: 11\n        }, this), getChatsByModel(activeModel).length > 0 ? [...getChatsByModel(activeModel)].reverse().map(chat => {\n          var _chat$lastMessage, _chatMenu$position, _chatMenu$position2;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `chat-item ${activeChat === chat.id ? 'active' : ''}`,\n            onClick: () => handleChatChange(chat.id),\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-title\",\n                children: chat.title\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 510,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-preview\",\n                children: [(_chat$lastMessage = chat.lastMessage) === null || _chat$lastMessage === void 0 ? void 0 : _chat$lastMessage.substring(0, 30), chat.lastMessage && chat.lastMessage.length > 30 ? '...' : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 511,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 509,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"chat-menu-button\",\n                onClick: e => handleOpenMenu(chat.id, e),\n                children: \"\\u22EE\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 517,\n                columnNumber: 19\n              }, this), chatMenu.isOpen && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"menu-overlay\",\n                  onClick: () => setChatMenu({\n                    chatId: null,\n                    isOpen: false,\n                    position: null\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 522,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-context-menu\",\n                  style: {\n                    top: `${(_chatMenu$position = chatMenu.position) === null || _chatMenu$position === void 0 ? void 0 : _chatMenu$position.top}px`,\n                    left: `${(_chatMenu$position2 = chatMenu.position) === null || _chatMenu$position2 === void 0 ? void 0 : _chatMenu$position2.left}px`\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"menu-item\",\n                    onClick: () => {\n                      var _chats$find3;\n                      const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', (_chats$find3 = chats.find(c => c.id === chatMenu.chatId)) === null || _chats$find3 === void 0 ? void 0 : _chats$find3.title);\n                      if (newName) handleRenameChat(newName);\n                    },\n                    children: \"\\u041F\\u0435\\u0440\\u0435\\u0438\\u043C\\u0435\\u043D\\u043E\\u0432\\u0430\\u0442\\u044C\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 533,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"menu-item delete\",\n                    onClick: handleDeleteChat,\n                    children: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0447\\u0430\\u0442\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 543,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 526,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 516,\n              columnNumber: 17\n            }, this)]\n          }, chat.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 504,\n            columnNumber: 15\n          }, this);\n        }) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-chats\",\n          children: \"\\u041D\\u0435\\u0442 \\u0447\\u0430\\u0442\\u043E\\u0432 \\u0432 \\u044D\\u0442\\u043E\\u0439 \\u043A\\u0430\\u0442\\u0435\\u0433\\u043E\\u0440\\u0438\\u0438\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 493,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 7\n    }, this), isMenuOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"menu-overlay\",\n      onClick: () => setIsMenuOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-container\",\n      children: messages.filter(msg => msg.parent_id === null).map(root => /*#__PURE__*/_jsxDEV(MessageThread, {\n        message: root,\n        messages: messages,\n        childIndexes: childIndexes,\n        setChildIndexes: setChildIndexes,\n        onLastMessageIdChange: id => {\n          console.log('Current last message ID:', id);\n          setRootID(id);\n        },\n        setReplyContext: setReplyContext\n      }, root.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 574,\n        columnNumber: 9\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 570,\n      columnNumber: 1\n    }, this), activeChat && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"input-area\",\n      children: [replyContext && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"reply-preview\",\n        children: [\"\\u041E\\u0442\\u0432\\u0435\\u0442 \\u043D\\u0430: \", replyContext.messageText, /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setReplyContext(null),\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"attach-button\",\n          onClick: () => {\n            var _fileInputRef$current;\n            return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n          },\n          children: \"\\uD83D\\uDCCE\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 617,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: fileInputRef,\n          onChange: handleAttachment,\n          style: {\n            display: 'none'\n          },\n          accept: \".pdf\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 624,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          value: inputText,\n          onChange: e => setInputText(e.target.value),\n          onKeyDown: handleKeyDown,\n          placeholder: \"\\u041D\\u0430\\u043F\\u0438\\u0448\\u0438\\u0442\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435...\",\n          rows: 1\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 632,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"send-button\",\n          onClick: handleSendMessage,\n          disabled: !inputText.trim() && !attachment,\n          children: attachment ? 'üì§' : '‚û§'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 640,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 616,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 608,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 399,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatApp, \"zDahl5zLmS2AvAkdSWSjBMNxtzA=\", false, function () {\n  return [useChats, useMessages, useStreamMessage, useUploadFile];\n});\n_c = ChatApp;\nexport default ChatApp;\nvar _c;\n$RefreshReg$(_c, \"ChatApp\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useChats","useMessages","useStreamMessage","MessageThread","v4","uuidv4","useUploadFile","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatApp","_s","_window$Telegram","_window$Telegram$WebA","_window$Telegram$WebA2","_chats$find","settings","setSettings","isOpen","theme","user","window","Telegram","WebApp","initDataUnsafe","id","first_name","photo_url","inputText","setInputText","replyContext","setReplyContext","attachment","setAttachment","isMenuOpen","setIsMenuOpen","chatMenu","setChatMenu","chatId","position","models","setModel","name","activeModel","setActiveModel","chats","setChats","activeChat","setActiveChat","createAuto","delChat","isCreatingChat","setIsCreatingChat","newChatTitle","setNewChatTitle","handleChatChange","prev","prevChat","find","c","isEmpty","filter","map","chat","unreadCount","newChatInputRef","current","focus","handleCreateChat","modelId","newChat","title","model","length","lastMessage","setParent","getChatsByModel","handleRenameChat","newName","handleDeleteChat","_remainingChats$","remainingChats","messages","setMessages","send","parentId","chunks","error","start","rootID","setRootID","upload","prevMessages","updatedMessages","lastIndex","content","join","_messagesEndRef$curre","console","log","messagesEndRef","scrollIntoView","behavior","handleSendMessage","trim","currentChat","requestMessage","newMsg","newChatId","telegram_id","chat_id","parent_id","res_ids","role","tempId","newResponse","fullResponse","requestMessageAs","responseAs","msg","messageId","lastRenderedMessageId","setLastRenderedMessageId","childIndexes","setChildIndexes","fileInputRef","_window$matchMedia","_window","isDarkMode","matchMedia","call","matches","document","body","classList","toggle","toggleTheme","newTheme","contains","generateBotResponse","userText","context","responses","messageText","Math","floor","random","handleAttachment","e","target","files","handleKeyDown","key","shiftKey","preventDefault","handleOpenMenu","stopPropagation","rect","currentTarget","getBoundingClientRect","top","bottom","left","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_chats$find2","currentModel","src","alt","onError","last_name","Boolean","username","language_code","toUpperCase","reverse","_chat$lastMessage","_chatMenu$position","_chatMenu$position2","substring","style","_chats$find3","prompt","root","message","onLastMessageIdChange","_fileInputRef$current","click","type","ref","onChange","display","accept","value","onKeyDown","placeholder","rows","disabled","_c","$RefreshReg$"],"sources":["/home/giicoo/projects/3DOM FRONT/3dom-Front/src/App.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useContext } from 'react';\nimport './ChatApp.css';\nimport { Chat, ChatMenu, Message, Model, ReplyContext, Settings, TelegramUser } from './types';\nimport { useChats } from './hooks/useChats';\nimport { useMessages, useStreamMessage } from './hooks/useMessages';\nimport { MessageIn } from './api/types';\nimport { MessageThread } from './components/message'\nimport { v4 as uuidv4 } from 'uuid';\nimport { useUploadFile } from './hooks/useFile';\n\n\nconst ChatApp: React.FC = () => {\n  const [settings, setSettings] = useState<Settings>({\n    isOpen: false,\n    theme: 'light'\n  });\n\n  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp\n  const user: TelegramUser = window.Telegram?.WebApp?.initDataUnsafe?.user || {\n    id:11,\n    first_name: '–ì–æ—Å—Ç—å',\n    photo_url: 'https://via.placeholder.com/100'\n  };\n\n\n  const [inputText, setInputText] = useState('');\n  const [replyContext, setReplyContext] = useState<ReplyContext | null>(null);\n  const [attachment, setAttachment] = useState<File | null>(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [chatMenu, setChatMenu] = useState<ChatMenu>({\n    chatId: null,\n    isOpen: false,\n    position: null\n  });\n\n\n  //____________MODELS_____________________________________________________________\n  // –≠—Ç–æ —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ backend\n  const [models, setModel] = useState<Model[]>([\n    { id: 'llama2', name: 'Llama 2' },\n    { id: 'deepseek-r1:8b', name: 'DeepSeek' },\n    { id: 'mistral', name: 'Mistral' },\n  ]);\n  const [activeModel, setActiveModel] = useState<string>('llama2');\n  //_____________________________________________________________________________________________\n\n//_____________CHATS__________________________________________________________________________\n  // const [chats, setChats] = useState<Chat[]>([\n  //   { id: '1', title: '–ß–∞—Ç 1', lastMessage: '–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫', model: 'llama2' },\n  //   { id: '2', title: '–ß–∞—Ç 2', lastMessage: '–ß–µ–º –º–æ–∂–µ–º –ø–æ–º–æ—á—å?', model: 'deepseek-r1' },\n  //   { id: '3', title: '–ß–∞—Ç 3', lastMessage: '–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã', model: 'mistral' },\n  // ]);\n  const {chats, setChats, activeChat, setActiveChat, createAuto, delChat} = useChats(user.id)\n  const [isCreatingChat, setIsCreatingChat] = useState(false);\n  const [newChatTitle, setNewChatTitle] = useState('');\n\n  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–∞\n  const handleChatChange = async (chatId: string) => {\n    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —á–∞—Ç, –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π\n    setChats(prev => {\n      const prevChat = prev.find(c => c.id === activeChat);\n      if (prevChat?.isEmpty) {\n        return prev.filter(c => c.id !== activeChat);\n      }\n      return prev;\n    });\n\n    setActiveChat(chatId);\n    setIsMenuOpen(false);\n\n    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ\n    setChats(prev => prev.map(chat =>\n      chat.id === chatId\n        ? { ...chat, unreadCount: 0 }\n        : chat\n    ));\n\n  };\n\n  // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–∞—Ç–∞\n  useEffect(() => {\n    if (isCreatingChat && newChatInputRef.current) {\n      newChatInputRef.current.focus();\n    }\n  }, [isCreatingChat]);\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞\n  const handleCreateChat = async (modelId: string) => {\n    const newChat: Chat = {\n      id: \"0\",\n      title: `–ß–∞—Ç ${chats.filter(c => c.model === modelId).length + 1}`,\n      lastMessage: '–ù–æ–≤—ã–π —á–∞—Ç —Å–æ–∑–¥–∞–Ω',\n      model: modelId,\n      isEmpty: true, // –¢–µ–ø–µ—Ä—å —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ\n    };\n\n    setChats(prev => [...prev, newChat]);\n    setParent(null)\n    await handleChatChange(newChat.id);\n   \n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –ø–æ –º–æ–¥–µ–ª—è–º\n  const getChatsByModel = (modelId: string) => {\n    return chats.filter(chat => chat.model === modelId);\n  };\n\n  // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–∞—Ç–∞, –±—ç–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç((\n  const handleRenameChat = (newName: string) => {\n    setChats(prev => prev.map(chat =>\n      chat.id === chatMenu.chatId ? { ...chat, title: newName } : chat\n    ));\n    setChatMenu({ chatId: null, isOpen: false, position: null });\n  };\n\n  // –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞\n  const handleDeleteChat = () => {\n    if (!chatMenu.chatId) return;\n\n    setChats(prev => prev.filter(chat => chat.id !== chatMenu.chatId));\n    if (activeChat === chatMenu.chatId) {\n      const remainingChats = chats.filter(chat => chat.id !== chatMenu.chatId);\n      setActiveChat(remainingChats[0]?.id || '');\n    }\n    delChat(chatMenu.chatId)\n\n    setChatMenu({ chatId: null, isOpen: false, position: null });\n  };\n//_____________________________________________________________________________\n\n  \n\n//__________________MESSAGES_________________________\n  const {messages, setMessages, send} = useMessages(activeChat);\n  const [parentId, setParent] = useState<string | null>(null);\n  const { chunks, error, start } = useStreamMessage(activeChat);\n  const [rootID, setRootID] = useState<string | null>(null)\n  const {upload} = useUploadFile();\n\n\n  useEffect(() => {\n    if (chunks.length > 0) {\n      setMessages(prevMessages => {\n        if (prevMessages.length === 0) return prevMessages;\n  \n        const updatedMessages = [...prevMessages];\n        const lastIndex = updatedMessages.length - 1;\n  \n        updatedMessages[lastIndex] = {\n          ...updatedMessages[lastIndex],\n          content: chunks.join(\"\"),\n        };\n  \n        return updatedMessages;\n      });\n    }\n  }, [chunks, parentId]);\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\n  useEffect(() => {\n    // TODO: –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∞ –∫–∞–∫-–Ω–∏–±—É–¥—å –ø–æ-–¥—Ä—É–≥–æ–º—É\n    // const welcomeMessage: Message = {\n    //   id: ,\n    //   parent_id: parent_id,\n    //   content: `–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —á–∞—Ç \"${chats.find(c => c.id === activeChat)?.title}\". –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?`,\n    //   role: 'assistant',\n    //   created_at: String(new Date()),\n    // };\n    // setMessages([welcomeMessage]);\n  }, [activeChat]);\n\n\n  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º\n  useEffect(() => {\n    console.log(messages)\n\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n\n\n  const handleSendMessage = async () => {\n    if (!inputText.trim() && !attachment) return;\n    const currentChat = chats.find(chat => chat.id === activeChat);\n    let requestMessage: MessageIn;\n    let newMsg: Message;\n\n    if (!currentChat || currentChat.isEmpty) {\n      // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ —Å –∞–≤—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –¥–µ–ª–∞–Ω–∏–µ –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º\n      const newChatId = await createAuto(inputText, { telegram_id: user.id, model: activeModel, title: '–ß–ë–î' });\n\n      requestMessage = {\n        chat_id: newChatId,\n        parent_id: null,\n        res_ids: [],\n        role: 'user',\n        content: inputText,\n      };\n      newMsg = await send(requestMessage);\n      setParent(newMsg.id);\n\n        // Reset input and attachment\n      setInputText('');\n      setAttachment(null);\n      setReplyContext(null);\n\n      // Start streaming the assistant response\n      const tempId = uuidv4();\n      const newResponse: Message = {\n        id: tempId,\n        parent_id: newMsg.id,\n        res_ids: newMsg.res_ids,\n        role: \"assistant\",\n        content: \"\",\n      }\n      setMessages(prev => [...prev, newResponse])\n\n\n      const fullResponse = await start(newMsg.id);\n\n\n      \n      const requestMessageAs: MessageIn = {\n        chat_id: requestMessage.chat_id,\n        parent_id: newMsg.id,\n        res_ids: newMsg.res_ids,\n        role: \"assistant\",\n        content: fullResponse,\n      };\n\n      const responseAs = await send(requestMessageAs);\n      setRootID(responseAs.id)\n      // –ó–∞–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (id === \"0\") –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ\n      setMessages(prev =>\n        prev.map(msg =>\n          msg.id === tempId\n            ? responseAs  // ‚úÖ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n            : msg\n        )\n      );\n\n      await handleChatChange(newChatId);\n      return;\n    } else {\n      requestMessage = {\n        chat_id: activeChat,\n        parent_id: replyContext ? replyContext.messageId: rootID,\n        res_ids: [],\n        role: 'user',\n        content: inputText,\n      };\n      newMsg = await send(requestMessage);\n      setParent(newMsg.id);\n\n    }\n\n    \n    \n\n    \n\n    // Reset input and attachment\n    setInputText('');\n    setAttachment(null);\n    setReplyContext(null);\n\n    // Start streaming the assistant response\n    const tempId = uuidv4();\n    const newResponse: Message = {\n      id: tempId,\n      parent_id: newMsg.id,\n      res_ids: newMsg.res_ids,\n      role: \"assistant\",\n      content: \"\",\n    }\n    setMessages(prev => [...prev, newResponse])\n\n\n    const fullResponse = await start(newMsg.id);\n\n\n    \n    const requestMessageAs: MessageIn = {\n      chat_id: requestMessage.chat_id,\n      parent_id: newMsg.id,\n      res_ids: newMsg.res_ids,\n      role: \"assistant\",\n      content: fullResponse,\n    };\n\n    const responseAs = await send(requestMessageAs);\n    setRootID(responseAs.id)\n    // –ó–∞–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (id === \"0\") –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ\n    setMessages(prev =>\n      prev.map(msg =>\n        msg.id === tempId\n          ? responseAs  // ‚úÖ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n          : msg\n      )\n    );\n\n    \n\n    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤\n    setChats(prev => prev.map(chat =>\n      chat.id === activeChat\n        ? { ...chat, lastMessage: inputText || '–í–ª–æ–∂–µ–Ω–∏–µ', unreadCount: 0 }\n        : chat\n    ));\n  };\n\n\n\n\n\n\n  const [lastRenderedMessageId, setLastRenderedMessageId] = useState<string | null>(null);\n\n  const [childIndexes, setChildIndexes] = useState<{ [parentId: string]: number }>({});\n\n//___________________________________________________________\n\n\n\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const newChatInputRef = useRef<HTMLInputElement>(null);\n\n  // –¢–µ–º—ã\n  useEffect(() => {\n    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Telegram API\n    const isDarkMode = window.matchMedia?.('(prefers-color-scheme: dark)').matches;\n    const theme = isDarkMode ? 'dark' : 'light';\n\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É\n    document.body.classList.toggle('dark-theme', theme === 'dark');\n  }, []);\n\n  // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Ç–µ–º—ã\n  const toggleTheme = () => {\n    const newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';\n    document.body.classList.toggle('dark-theme', newTheme === 'dark');\n  };\n\n\n\n\n\n  \n\n  \n  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞\n  const generateBotResponse = (userText: string, context: ReplyContext | null): string => {\n    const responses = [\n      \"–Ø –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.\",\n      \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤–º–µ—Å—Ç–µ.\",\n      \"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –Ø —É–∂–µ —Ä–∞–±–æ—Ç–∞—é –Ω–∞–¥ —ç—Ç–∏–º.\",\n      \"–•–æ—Ä–æ—à–æ, —è –∑–∞–ø–∏—Å–∞–ª —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ß—Ç–æ –µ—â–µ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?\",\n      \"–û—Ç–ª–∏—á–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ! –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏–º –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä.\"\n    ];\n\n    if (context) {\n      return `–û—Ç–≤–µ—á–∞—è –Ω–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ \"${context.messageText}\": ${responses[Math.floor(Math.random() * responses.length)]}`;\n    }\n\n    return responses[Math.floor(Math.random() * responses.length)];\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞\n  const handleAttachment = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      setAttachment(e.target.files[0]);\n      upload(activeChat, e.target.files[0])\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n  \n  const handleOpenMenu = (chatId: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    const rect = e.currentTarget.getBoundingClientRect();\n    setChatMenu({\n      chatId,\n      isOpen: true,\n      position: { top: rect.bottom + 5, left: rect.left - 100 }\n    });\n  };\n\n\n\n  return (\n    <div className=\"chat-app\">\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ - —É–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è */}\n      <div className=\"chat-header\">\n        <button className=\"menu-button\" onClick={() => setIsMenuOpen(!isMenuOpen)}>\n          ‚ò∞\n        </button>\n        <h2>{chats.find(c => c.id === activeChat)?.title || '–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç'}</h2>\n        {activeChat && (\n          <button\n            className=\"create-chat-button\"\n            onClick={() => {\n              const currentModel = chats.find(c => c.id === activeChat)?.model || activeModel;\n              handleCreateChat(currentModel);\n            }}\n          >\n            Ôºã\n          </button>\n        )}\n      </div>\n\n      {/* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */}\n      <div className={`side-menu ${isMenuOpen ? 'open' : ''}`}>\n        <button\n          className=\"settings-button\"\n          onClick={() => setSettings(prev => ({ ...prev, isOpen: true }))}\n        >\n          ‚öôÔ∏è\n        </button>\n        {settings.isOpen && (\n          <div className=\"settings-modal\">\n            <div className=\"settings-content\">\n              <button\n                className=\"close-settings\"\n                onClick={() => setSettings(prev => ({ ...prev, isOpen: false }))}\n              >\n                √ó\n              </button>\n\n              <div className=\"user-profile\">\n                <img\n                  src={user.photo_url || 'https://via.placeholder.com/100'}\n                  alt=\"–ê–≤–∞—Ç–∞—Ä\"\n                  className=\"user-avatar\"\n                  onError={(e) => {\n                    (e.target as HTMLImageElement).src = 'https://via.placeholder.com/100';\n                  }}\n                />\n                <h3>\n                  {[user.first_name, user.last_name]\n                    .filter(Boolean)\n                    .join(' ') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}\n                </h3>\n                {user.username && <p>@{user.username}</p>}\n                {user.language_code && <p>–Ø–∑—ã–∫: {user.language_code.toUpperCase()}</p>}\n              </div>\n\n              <div className=\"theme-switcher\">\n                <button\n                  onClick={() => {\n                    const newTheme = settings.theme === 'light' ? 'dark' : 'light';\n                    setSettings(prev => ({ ...prev, theme: newTheme }));\n                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–º–µ–Ω—ã —Ç–µ–º—ã –≤ Telegram WebApp\n                  }}\n                >\n                  {settings.theme === 'light' ? 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞'}\n                </button>\n              </div>\n            </div>\n            <div\n              className=\"settings-overlay\"\n              onClick={() => setSettings(prev => ({ ...prev, isOpen: false }))}\n            />\n          </div>\n        )}\n\n        <div className=\"menu-header\">\n          <h3>–ú–æ–∏ —á–∞—Ç—ã</h3>\n          <button className=\"close-menu\" onClick={() => setIsMenuOpen(false)}>\n            √ó\n          </button>\n        </div>\n\n        <div className=\"categories-tabs\">\n          {models.map(model => (\n            <button\n              key={model.id}\n              className={`category-tab ${activeModel === model.id ? 'active' : ''}`}\n              onClick={() => setActiveModel(model.id)}\n            >\n              {model.name}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"chat-list\">\n          {/* –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é */}\n          <button\n            className=\"create-chat-in-category small\"\n            onClick={() => handleCreateChat(activeModel)}\n          >\n            Ôºã –°–æ–∑–¥–∞—Ç—å —á–∞—Ç\n          </button>\n\n          {getChatsByModel(activeModel).length > 0 ? (\n            [...getChatsByModel(activeModel)].reverse().map(chat => (\n              <div\n                key={chat.id}\n                className={`chat-item ${activeChat === chat.id ? 'active' : ''}`}\n                onClick={() => handleChatChange(chat.id)}\n              >\n                <div className=\"chat-info\">\n                  <div className=\"chat-title\">{chat.title}</div>\n                  <div className=\"chat-preview\">\n                    {chat.lastMessage?.substring(0, 30)}{chat.lastMessage && chat.lastMessage.length > 30 ? '...' : ''}\n                  </div>\n                </div>\n\n                <div className=\"chat-actions\">\n                  <button className=\"chat-menu-button\" onClick={(e) => handleOpenMenu(chat.id, e)}>\n                    ‚ãÆ\n                  </button>\n                  {chatMenu.isOpen && (\n                    <>\n                      <div\n                        className=\"menu-overlay\"\n                        onClick={() => setChatMenu({ chatId: null, isOpen: false, position: null })}\n                      />\n                      <div\n                        className=\"chat-context-menu\"\n                        style={{\n                          top: `${chatMenu.position?.top}px`,\n                          left: `${chatMenu.position?.left}px`\n                        }}\n                      >\n                        <button\n                          className=\"menu-item\"\n                          onClick={() => {\n                            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:',\n                              chats.find(c => c.id === chatMenu.chatId)?.title);\n                            if (newName) handleRenameChat(newName);\n                          }}\n                        >\n                          –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å\n                        </button>\n                        <button\n                          className=\"menu-item delete\"\n                          onClick={handleDeleteChat}\n                        >\n                          –£–¥–∞–ª–∏—Ç—å —á–∞—Ç\n                        </button>\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"no-chats\">\n              –ù–µ—Ç —á–∞—Ç–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n            </div>\n          )}\n        </div>\n      </div>\n\n\n      {/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–µ–Ω—é */}\n      {isMenuOpen && (\n        <div className=\"menu-overlay\" onClick={() => setIsMenuOpen(false)} />\n      )}\n\n\n<div className=\"messages-container\">\n    {messages\n      .filter(msg => msg.parent_id === null)\n      .map((root) => (\n        <MessageThread\n          key={root.id}\n          message={root}\n          messages={messages}\n          childIndexes={childIndexes}\n          setChildIndexes={setChildIndexes}\n          onLastMessageIdChange={(id) => {\n            console.log('Current last message ID:', id);\n            setRootID(id)\n          }}\n          setReplyContext={setReplyContext}\n        />\n      ))}\n  </div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n      {/* –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —á–∞—Ç) */}\n      {activeChat && (\n        <div className=\"input-area\">\n          {replyContext && (\n            <div className=\"reply-preview\">\n              –û—Ç–≤–µ—Ç –Ω–∞: {replyContext.messageText}\n              <button onClick={() => setReplyContext(null)}>√ó</button>\n            </div>\n          )}\n\n          <div className=\"input-container\">\n            <button\n              className=\"attach-button\"\n              onClick={() => fileInputRef.current?.click()}\n            >\n              üìé\n            </button>\n\n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              onChange={handleAttachment}\n              style={{ display: 'none' }}\n              accept=\".pdf\"\n            />\n\n            <textarea\n              value={inputText}\n              onChange={(e) => setInputText(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...\"\n              rows={1}\n            />\n\n            <button\n              className=\"send-button\"\n              onClick={handleSendMessage}\n              disabled={!inputText.trim() && !attachment}\n            >\n              {attachment ? 'üì§' : '‚û§'}\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ChatApp;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}