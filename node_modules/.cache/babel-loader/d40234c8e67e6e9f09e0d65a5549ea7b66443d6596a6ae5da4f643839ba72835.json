{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export const MessageThread=_ref=>{let{message,messages,childIndexes,setChildIndexes,onLastMessageIdChange,setReplyContext}=_ref;const children=messages.filter(m=>m.parent_id===message.id);const index=childIndexes[message.id]||0;const selfRef=useRef(null);const handleNext=()=>{setChildIndexes(prev=>({...prev,[message.id]:(index+1)%children.length}));};const handlePrev=()=>{setChildIndexes(prev=>({...prev,[message.id]:(index-1+children.length)%children.length}));};// Если нет дочерних сообщений, мы — последний\nuseEffect(()=>{if(onLastMessageIdChange&&children.length===0){onLastMessageIdChange(message.id);}},[children.length,message.id,onLastMessageIdChange]);return/*#__PURE__*/_jsxs(_Fragment,{children:[message.parent_id===null&&/*#__PURE__*/_jsx(\"div\",{className:`message ${message.role}`,ref:selfRef,children:message.content}),children.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:`message ${children[index].role}`,ref:selfRef,onClick:()=>children[index].role===\"assistant\"&&setReplyContext({messageId:children[index].id,messageText:children[index].content}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:children[index].content}),children.length>1&&children[index].role===\"user\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"message-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePrev,children:\"\\u25C0\\uFE0F\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleNext,children:\"\\u25B6\\uFE0F\"})]})]}),/*#__PURE__*/_jsx(MessageThread,{message:children[index],messages:messages,childIndexes:childIndexes,setChildIndexes:setChildIndexes,onLastMessageIdChange:onLastMessageIdChange,setReplyContext:setReplyContext})]})]});};","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MessageThread","_ref","message","messages","childIndexes","setChildIndexes","onLastMessageIdChange","setReplyContext","children","filter","m","parent_id","id","index","selfRef","handleNext","prev","length","handlePrev","className","role","ref","content","onClick","messageId","messageText"],"sources":["/home/giicoo/projects/3DOM FRONT/3dom-Front/src/components/message.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport type { Message, ReplyContext } from '../types';\n\ntype MessageThreadProps = {\n  message: Message;\n  messages: Message[];\n  childIndexes: { [parentId: string]: number };\n  setChildIndexes: React.Dispatch<React.SetStateAction<{ [parentId: string]: number }>>;\n  onLastMessageIdChange?: (id: string) => void;\n  setReplyContext: React.Dispatch<React.SetStateAction<ReplyContext | null>>;\n};\n\nexport const MessageThread: React.FC<MessageThreadProps> = ({\n  message,\n  messages,\n  childIndexes,\n  setChildIndexes,\n  onLastMessageIdChange,\n  setReplyContext,\n}) => {\n  const children = messages.filter((m) => m.parent_id === message.id);\n  const index = childIndexes[message.id] || 0;\n  const selfRef = useRef<HTMLDivElement>(null);\n\n  const handleNext = () => {\n    setChildIndexes((prev) => ({\n      ...prev,\n      [message.id]: (index + 1) % children.length,\n    }));\n  };\n\n  const handlePrev = () => {\n    setChildIndexes((prev) => ({\n      ...prev,\n      [message.id]: (index - 1 + children.length) % children.length,\n    }));\n  };\n\n  // Если нет дочерних сообщений, мы — последний\n  useEffect(() => {\n    if (onLastMessageIdChange && children.length === 0) {\n      onLastMessageIdChange(message.id);\n    }\n  }, [children.length, message.id, onLastMessageIdChange]);\n\n  return (\n    <>\n      {message.parent_id === null && (\n        <div className={`message ${message.role}`} ref={selfRef}>\n          {message.content}\n        </div>\n      )}\n\n      {children.length > 0 && (\n        <div>\n          <div \n          className={`message ${children[index].role}`} \n          ref={selfRef}\n          onClick={() => \n            children[index].role===\"assistant\" && (setReplyContext({\n            messageId: children[index].id,\n            messageText: children[index].content,\n          })) }\n          >\n            <div className=\"message-content\">{children[index].content}</div>\n            {children.length > 1 && children[index].role===\"user\"  &&(\n              <div className=\"message-controls\">\n                <button onClick={handlePrev}>◀️</button>\n                <button onClick={handleNext}>▶️</button>\n              </div>\n            )}\n          </div>\n\n          <MessageThread\n            message={children[index]}\n            messages={messages}\n            childIndexes={childIndexes}\n            setChildIndexes={setChildIndexes}\n            onLastMessageIdChange={onLastMessageIdChange}\n            setReplyContext={setReplyContext}\n          />\n        </div>\n      )}\n    </>\n  );\n};\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,KAAkB,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAY3D,MAAO,MAAM,CAAAC,aAA2C,CAAGC,IAAA,EAOrD,IAPsD,CAC1DC,OAAO,CACPC,QAAQ,CACRC,YAAY,CACZC,eAAe,CACfC,qBAAqB,CACrBC,eACF,CAAC,CAAAN,IAAA,CACC,KAAM,CAAAO,QAAQ,CAAGL,QAAQ,CAACM,MAAM,CAAEC,CAAC,EAAKA,CAAC,CAACC,SAAS,GAAKT,OAAO,CAACU,EAAE,CAAC,CACnE,KAAM,CAAAC,KAAK,CAAGT,YAAY,CAACF,OAAO,CAACU,EAAE,CAAC,EAAI,CAAC,CAC3C,KAAM,CAAAE,OAAO,CAAGrB,MAAM,CAAiB,IAAI,CAAC,CAE5C,KAAM,CAAAsB,UAAU,CAAGA,CAAA,GAAM,CACvBV,eAAe,CAAEW,IAAI,GAAM,CACzB,GAAGA,IAAI,CACP,CAACd,OAAO,CAACU,EAAE,EAAG,CAACC,KAAK,CAAG,CAAC,EAAIL,QAAQ,CAACS,MACvC,CAAC,CAAC,CAAC,CACL,CAAC,CAED,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvBb,eAAe,CAAEW,IAAI,GAAM,CACzB,GAAGA,IAAI,CACP,CAACd,OAAO,CAACU,EAAE,EAAG,CAACC,KAAK,CAAG,CAAC,CAAGL,QAAQ,CAACS,MAAM,EAAIT,QAAQ,CAACS,MACzD,CAAC,CAAC,CAAC,CACL,CAAC,CAED;AACAzB,SAAS,CAAC,IAAM,CACd,GAAIc,qBAAqB,EAAIE,QAAQ,CAACS,MAAM,GAAK,CAAC,CAAE,CAClDX,qBAAqB,CAACJ,OAAO,CAACU,EAAE,CAAC,CACnC,CACF,CAAC,CAAE,CAACJ,QAAQ,CAACS,MAAM,CAAEf,OAAO,CAACU,EAAE,CAAEN,qBAAqB,CAAC,CAAC,CAExD,mBACET,KAAA,CAAAE,SAAA,EAAAS,QAAA,EACGN,OAAO,CAACS,SAAS,GAAK,IAAI,eACzBhB,IAAA,QAAKwB,SAAS,CAAE,WAAWjB,OAAO,CAACkB,IAAI,EAAG,CAACC,GAAG,CAAEP,OAAQ,CAAAN,QAAA,CACrDN,OAAO,CAACoB,OAAO,CACb,CACN,CAEAd,QAAQ,CAACS,MAAM,CAAG,CAAC,eAClBpB,KAAA,QAAAW,QAAA,eACEX,KAAA,QACAsB,SAAS,CAAE,WAAWX,QAAQ,CAACK,KAAK,CAAC,CAACO,IAAI,EAAG,CAC7CC,GAAG,CAAEP,OAAQ,CACbS,OAAO,CAAEA,CAAA,GACPf,QAAQ,CAACK,KAAK,CAAC,CAACO,IAAI,GAAG,WAAW,EAAKb,eAAe,CAAC,CACvDiB,SAAS,CAAEhB,QAAQ,CAACK,KAAK,CAAC,CAACD,EAAE,CAC7Ba,WAAW,CAAEjB,QAAQ,CAACK,KAAK,CAAC,CAACS,OAC/B,CAAC,CAAI,CAAAd,QAAA,eAEHb,IAAA,QAAKwB,SAAS,CAAC,iBAAiB,CAAAX,QAAA,CAAEA,QAAQ,CAACK,KAAK,CAAC,CAACS,OAAO,CAAM,CAAC,CAC/Dd,QAAQ,CAACS,MAAM,CAAG,CAAC,EAAIT,QAAQ,CAACK,KAAK,CAAC,CAACO,IAAI,GAAG,MAAM,eACnDvB,KAAA,QAAKsB,SAAS,CAAC,kBAAkB,CAAAX,QAAA,eAC/Bb,IAAA,WAAQ4B,OAAO,CAAEL,UAAW,CAAAV,QAAA,CAAC,cAAE,CAAQ,CAAC,cACxCb,IAAA,WAAQ4B,OAAO,CAAER,UAAW,CAAAP,QAAA,CAAC,cAAE,CAAQ,CAAC,EACrC,CACN,EACE,CAAC,cAENb,IAAA,CAACK,aAAa,EACZE,OAAO,CAAEM,QAAQ,CAACK,KAAK,CAAE,CACzBV,QAAQ,CAAEA,QAAS,CACnBC,YAAY,CAAEA,YAAa,CAC3BC,eAAe,CAAEA,eAAgB,CACjCC,qBAAqB,CAAEA,qBAAsB,CAC7CC,eAAe,CAAEA,eAAgB,CAClC,CAAC,EACC,CACN,EACD,CAAC,CAEP,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}